---
export const prerender = true

import ProductView from "@components/shop/ProductView.astro"
import { getStripeProducts } from "@utils/serverless"
import type { Currency } from "@utils/stripe"
import { defaultLocale, localeToCurrency } from "@utils/currency"

export async function getStaticPaths() {
    const products = await getStripeProducts()
    return products.map(product => ({
        params: {
            category: product.metadata.category,
            slug: product.metadata.slug,
        },
    }))
}

const { slug } = Astro.params
const currency = localeToCurrency[defaultLocale] as Currency
const products = await getStripeProducts()
const product = products.filter(product => product.metadata.slug === slug)[0]

if (!product) return Astro.redirect("/404")
---

<ProductView locale={defaultLocale} currency={currency} product={product} />
