---
import BaseLayout from "@layouts/BaseLayout.astro"
---

<BaseLayout
    title="Checkout | Andrea Diotallevi Art"
    description="Complete your purchase quickly and securely with Stripe. Our streamlined checkout process is safe and easy, ensuring your details are protected."
    hideFooter={true}
>
    <div id="checkout" class="px-4 py-8"></div>
</BaseLayout>

<script is:inline>
    import { loadStripe } from "@stripe/stripe-js"

    let checkout
    console.log("testing checkout page")

    // document.addEventListener("astro:page-load", async () => {
    console.log("checkout script")
    console.log(window.location.pathname)
    console.log("")
    const checkoutElement = document.querySelector("#checkout")

    console.log(checkoutElement)

    if (checkoutElement) {
        const stripe = await loadStripe(
            import.meta.env.PUBLIC_STRIPE_PUBLISHABLE_KEY
        )

        const params = new URLSearchParams(window.location.search)
        const clientSecret = params.get("client_secret") || ""

        if (checkout) {
            console.log("Destroying checkout...")
            checkout.destroy()
        }

        checkout = await stripe?.initEmbeddedCheckout({
            clientSecret,
        })

        checkout?.mount(checkoutElement)
    }
    // })
</script>
